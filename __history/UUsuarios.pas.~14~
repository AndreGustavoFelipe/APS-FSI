unit UUsuarios;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.Buttons, Vcl.ExtCtrls, Data.DB,
  Vcl.Imaging.pngimage, Vcl.StdCtrls, Vcl.Grids, Vcl.DBGrids, Vcl.ComCtrls,
  cxGraphics, cxControls, cxLookAndFeels, cxLookAndFeelPainters, cxStyles,
  cxCustomData, cxFilter, cxData, cxDataStorage, cxEdit, cxNavigator, cxDBData,
  FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Param,
  FireDAC.Stan.Error, FireDAC.DatS, FireDAC.Phys.Intf, FireDAC.DApt.Intf,
  FireDAC.Stan.Async, FireDAC.DApt, cxGridCustomTableView, cxGridTableView,
  cxGridDBTableView, FireDAC.Comp.DataSet, FireDAC.Comp.Client, cxGridLevel,
  cxClasses, cxGridCustomView, cxGrid, UDataModule, cxGridChartView,
  cxGridDBChartView, Vcl.DBCtrls;

type
  TFormUsuarios = class(TForm)
    Panel1: TPanel;
    Panel2: TPanel;
    Panel8: TPanel;
    btnNovoUsuario: TSpeedButton;
    Panel3: TPanel;
    btnEditar: TSpeedButton;
    Panel4: TPanel;
    btnExcluir: TSpeedButton;
    pgControl: TPageControl;
    tabListagem: TTabSheet;
    DBGrid1: TDBGrid;
    tabCad: TTabSheet;
    Panel5: TPanel;
    edtCadSenha: TEdit;
    Panel6: TPanel;
    edtCadUsuario: TEdit;
    rdGroupTipos: TRadioGroup;
    imgCadeado: TImage;
    Panel7: TPanel;
    pnlSalvar: TPanel;
    btnSalvar: TSpeedButton;
    pnlCancelar: TPanel;
    btnCancelar: TSpeedButton;
    Panel9: TPanel;
    btnVoltar: TSpeedButton;
    queryUsuarios: TFDQuery;
    dsUsuarios: TDataSource;
    queryUsuariosID: TIntegerField;
    queryUsuariosNOME: TStringField;
    queryUsuariosSENHA: TStringField;
    queryUsuariosTIPO: TSmallintField;
    cxGrid1DBTableView1: TcxGridDBTableView;
    cxGrid1Level1: TcxGridLevel;
    cxGrid1: TcxGrid;
    cxGrid1DBChartView1: TcxGridDBChartView;
    cxGrid1DBChartView1Series1: TcxGridDBChartSeries;
    cxGrid1DBTableView1ID: TcxGridDBColumn;
    cxGrid1DBTableView1NOME: TcxGridDBColumn;
    cxGrid1DBTableView1SENHA: TcxGridDBColumn;
    cxGrid1DBTableView1TIPO: TcxGridDBColumn;
    procedure imgCadeadoClick(Sender: TObject);
    procedure btnNovoUsuarioClick(Sender: TObject);
    procedure btnEditarClick(Sender: TObject);
    procedure btnCancelarClick(Sender: TObject);
    procedure btnSalvarClick(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure pgControlChange(Sender: TObject);
    procedure btnVoltarClick(Sender: TObject);
    procedure btnExcluirClick(Sender: TObject);
  private
    operacao : integer; // 0 -> Cadastro // 1 -> Edição // 2 -> Exclusão
  public
    { Public declarations }
  end;

var
  FormUsuarios: TFormUsuarios;

implementation

{$R *.dfm}

procedure TFormUsuarios.btnCancelarClick(Sender: TObject);
begin
   // limpa campos da tab usuario
   pgControl.TabIndex := 0;
end;

procedure TFormUsuarios.btnNovoUsuarioClick(Sender: TObject);
begin
  operacao := 0;
  pgControl.TabIndex := 1;
end;

procedure TFormUsuarios.btnSalvarClick(Sender: TObject);
begin

  case operacao of
    0:
    begin
      with TFDQuery.Create(Self) do
      begin
        try
          Connection := dm.con;

          SQL.Clear;
          SQL.Add('insert into USUARIOS(NOME, SENHA, TIPO)');
          SQL.Add('values(:nome, :senha, :tipo)');

          ParamByName('nome').Value := edtCadUsuario.Text;
          ParamByName('senha').Value := edtCadSenha.Text;
          ParamByName('tipo').Value := rdGroupTipos.ItemIndex;

          ExecSQL;
        finally
          Free;
        end;
      end;
    end;

    1:
    begin

    end;

  end;

  ShowMessage('Cadastrado com Sucesso!');

  queryUsuarios.Close;
  queryUsuarios.Open;
  pgControl.TabIndex := 0;
end;

procedure TFormUsuarios.btnVoltarClick(Sender: TObject);
begin
  Close;
end;

procedure TFormUsuarios.FormShow(Sender: TObject);
begin
  operacao := 0;
  pgControl.TabIndex := 0;
  queryUsuarios.Open;
end;

procedure TFormUsuarios.imgCadeadoClick(Sender: TObject);
var
  picture : TPicture;
  aux : string;
begin
  picture := TPicture.Create;
  try
    if imgCadeado.Tag = 0 then
    begin
      aux := 'imgs\telaLogin\cadeadoAberto.png';
      edtCadSenha.PasswordChar :=  #0;
      imgCadeado.Tag := 1;
    end
    else
    begin
      aux := 'imgs\telaLogin\cadeadoFechado.png';
      edtCadSenha.PasswordChar := '*';
      imgCadeado.Tag := 0;
    end;
    picture.LoadFromFile(ExtractFilePath(ParamStr(0)) + aux);
    imgCadeado.Picture.Assign(picture);

  finally
    picture.Free;
  end;
end;

procedure TFormUsuarios.pgControlChange(Sender: TObject);
begin
  operacao := 0;
end;

procedure TFormUsuarios.btnEditarClick(Sender: TObject);
begin
  operacao := 1;
  pgControl.TabIndex := 1;
end;

procedure TFormUsuarios.btnExcluirClick(Sender: TObject);
begin

  ShowMessage('Tem certeza que deseja excluir o usuario sistema teste?');
//  with TFormUsuarios.Create(self) do
//  begin
//    try
//
//    finally
//
//    end;
//  end;
end;

end.
